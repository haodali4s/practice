{"ast":null,"code":"import Vue from \"vue\";\nimport Vuerouter from \"vue-router\";\nVue.use(Vuerouter);\nimport store from '../store';\nimport myorder from \"@/pages/center/myOrder/index.vue\";\nimport teamorder from \"@/pages/center/teamOrder/index.vue\";\nlet router = new Vuerouter({\n  routes: [{\n    path: '/',\n    redirect: '/home'\n  }, {\n    path: '/home',\n    component: () => import(\"@/pages/home/index.vue\"),\n    name: 'home',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/login',\n    component: () => import(\"@/pages/login/index.vue\"),\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/trade',\n    component: () => import(\"@/pages/trade/index.vue\"),\n    beforeEnter(to, from, next) {\n      if (from.path == '/shopcart') {\n        next();\n      } else {\n        next(false);\n      }\n    },\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/register',\n    component: () => import(\"@/pages/register/index.vue\"),\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/search/:keyword?',\n    component: () => import(\"@/pages/search/index.vue\"),\n    name: 'search',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/detail/:spid',\n    component: () => import(\"@/pages/detail/index.vue\"),\n    name: 'detail',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/addcartsuccess',\n    component: () => import(\"@/pages/addcartsuccess/index.vue\"),\n    name: 'addcartsuccess',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/shopcart',\n    component: () => import(\"@/pages/shopcart/index.vue\"),\n    name: 'shopcart',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/pay',\n    component: () => import(\"@/pages/pay/index.vue\"),\n    name: 'pay',\n    beforeEnter(to, from, next) {\n      if (from.path == '/trade') {\n        next();\n      } else {\n        next(false);\n      }\n    },\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/success',\n    component: () => import(\"@/pages/paysuccess/index.vue\"),\n    name: 'success',\n    meta: {\n      show: false\n    },\n    beforeEnter(to, from, next) {\n      if (from.path == '/pay') {\n        next();\n      } else {\n        next(false);\n      }\n    }\n  }, {\n    path: '/center',\n    component: () => import(\"@/pages/center/index.vue\"),\n    name: 'center',\n    meta: {\n      show: true\n    },\n    children: [{\n      path: \"myorder\",\n      component: myorder\n    }, {\n      path: \"teamorder\",\n      component: teamorder\n    }, {\n      path: \"/center\",\n      redirect: \"/center/myorder\"\n    }]\n  }],\n  scrollBehavior() {\n    return {\n      x: 0,\n      y: 0\n    };\n  }\n});\nrouter.beforeEach(async (to, from, next) => {\n  //to:去的那个路由的信息\n  //from:从那个路由而来的信息\n  //next:放行函数!!!!!! \n  //第一种：next(),放行函数，放行到它想去的路由！！！\n  //第二种:next(path),守卫指定放行到那个路由去?\n\n  //用户是否登录:取决于仓库里面是否有token！！！\n  //每一次路由跳转之前需要用有用户信息在跳转,没有发请求获取用户信息在跳转！！！！\n  //token\n  let hasToken = store.state.user.token;\n  //用户信息\n  let hasNickName = store.state.user.userdata.nickName;\n  //用户登录\n  if (hasToken) {\n    //用户登录了,不能去login\n    if (to.path == \"/login\") {\n      next(from.fullPath);\n    } else {\n      //用户登陆了,而且还有用户信息【去的并非是login】\n      if (hasNickName) {\n        next();\n      } else {\n        try {\n          //发请求获取用户信息以后在放行\n          await store.dispatch('getUserInfo');\n          next();\n        } catch (error) {\n          //用户没有信息，还携带token发请求获取用户信息【失败】\n          //token【学生证失效了】\n          //token失效:本地清空数据、服务器的token通知服务器清除\n          await store.dispatch('logout');\n\n          //回到登录页，重新获取一个新的学生证\n          next('/login');\n        }\n        // await store.dispatch('logout');\n      }\n    }\n  } else {\n    if (to.path.indexOf('trade') != -1 || to.path.indexOf('pay') != -1 || to.path.indexOf('center') != -1) {\n      next('/login?redirect=' + to.path);\n    } else {\n      next();\n    }\n    //用户未登录||目前的判断都是放行.将来这里会'回手掏'增加一些判断\n    //用户未登录:不能进入/trade、/pay、/paysuccess、/center、/center/myorder  /center/teamorder\n    // let toPath = to.path;\n    // if (toPath.indexOf('trade') != -1 || toPath.indexOf('pay') != -1 || toPath.indexOf('center') != -1) {\n    //     next('/login?redirect=' + toPath);\n    // } else {\n    //     next();\n    // }\n  }\n});\n\nexport default router;","map":{"version":3,"names":["Vue","Vuerouter","use","store","myorder","teamorder","router","routes","path","redirect","component","name","meta","show","beforeEnter","to","from","next","children","scrollBehavior","x","y","beforeEach","hasToken","state","user","token","hasNickName","userdata","nickName","fullPath","dispatch","error","indexOf"],"sources":["E:/360MoveData/Users/Admin/Desktop/qian/cil/shangpinhui/src/router/router.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport Vuerouter from \"vue-router\"\r\nVue.use(Vuerouter)\r\n\r\nimport store from '../store'\r\n\r\nimport myorder from \"@/pages/center/myOrder/index.vue\"\r\nimport teamorder from \"@/pages/center/teamOrder/index.vue\"\r\n\r\nlet router = new Vuerouter({\r\n    routes: [\r\n        {\r\n            path: '/',\r\n            redirect: '/home'\r\n        },\r\n        {\r\n            path: '/home',\r\n            component: () => import(\"@/pages/home/index.vue\"),\r\n            name: 'home',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/login',\r\n            component: () => import(\"@/pages/login/index.vue\"),\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/trade',\r\n            component: () => import(\"@/pages/trade/index.vue\"),\r\n            beforeEnter(to, from, next) {\r\n                if (from.path == '/shopcart') {\r\n                    next()\r\n                }\r\n                else {\r\n                    next(false)\r\n                }\r\n            },\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/register',\r\n            component: () => import(\"@/pages/register/index.vue\"),\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/search/:keyword?',\r\n            component: () => import(\"@/pages/search/index.vue\"),\r\n\r\n            name: 'search',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/detail/:spid',\r\n            component: () => import(\"@/pages/detail/index.vue\"),\r\n\r\n            name: 'detail',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/addcartsuccess',\r\n            component: () => import(\"@/pages/addcartsuccess/index.vue\"),\r\n\r\n            name: 'addcartsuccess',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/shopcart',\r\n            component: () => import(\"@/pages/shopcart/index.vue\"),\r\n\r\n            name: 'shopcart',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/pay',\r\n            component: () => import(\"@/pages/pay/index.vue\"),\r\n\r\n            name: 'pay',\r\n            beforeEnter(to, from, next) {\r\n                if (from.path == '/trade') {\r\n                    next()\r\n                }\r\n                else {\r\n                    next(false)\r\n                }\r\n            },\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/success',\r\n            component: () => import(\"@/pages/paysuccess/index.vue\"),\r\n\r\n            name: 'success',\r\n            meta: {\r\n                show: false\r\n            },\r\n            beforeEnter(to, from, next) {\r\n                if (from.path == '/pay') {\r\n                    next()\r\n                }\r\n                else {\r\n                    next(false)\r\n                }\r\n            },\r\n        },\r\n        {\r\n            path: '/center',\r\n            component: () => import(\"@/pages/center/index.vue\"),\r\n\r\n            name: 'center',\r\n            meta: {\r\n                show: true\r\n            },\r\n            children: [\r\n                {\r\n                    path: \"myorder\",\r\n                    component: myorder\r\n                },\r\n                {\r\n                    path: \"teamorder\",\r\n                    component: teamorder\r\n                },\r\n                {\r\n                    path: \"/center\",\r\n                    redirect: \"/center/myorder\"\r\n                },\r\n            ]\r\n        },\r\n    ],\r\n    scrollBehavior() {\r\n        return { x: 0, y: 0 }\r\n    }\r\n\r\n})\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n    //to:去的那个路由的信息\r\n    //from:从那个路由而来的信息\r\n    //next:放行函数!!!!!! \r\n    //第一种：next(),放行函数，放行到它想去的路由！！！\r\n    //第二种:next(path),守卫指定放行到那个路由去?\r\n\r\n    //用户是否登录:取决于仓库里面是否有token！！！\r\n    //每一次路由跳转之前需要用有用户信息在跳转,没有发请求获取用户信息在跳转！！！！\r\n    //token\r\n    let hasToken = store.state.user.token;\r\n    //用户信息\r\n    let hasNickName = store.state.user.userdata.nickName;\r\n    //用户登录\r\n    if (hasToken) {\r\n        //用户登录了,不能去login\r\n        if (to.path == \"/login\") {\r\n\r\n            next(from.fullPath);\r\n        } else {\r\n            //用户登陆了,而且还有用户信息【去的并非是login】\r\n            if (hasNickName) {\r\n                next();\r\n            } else {\r\n                try {\r\n                    //发请求获取用户信息以后在放行\r\n                    await store.dispatch('getUserInfo');\r\n                    next();\r\n                } catch (error) {\r\n                    //用户没有信息，还携带token发请求获取用户信息【失败】\r\n                    //token【学生证失效了】\r\n                    //token失效:本地清空数据、服务器的token通知服务器清除\r\n                    await store.dispatch('logout');\r\n\r\n                    //回到登录页，重新获取一个新的学生证\r\n                    next('/login');\r\n                }\r\n                // await store.dispatch('logout');\r\n            }\r\n        }\r\n    } else {\r\n        if (to.path.indexOf('trade') != -1 || to.path.indexOf('pay') != -1 || to.path.indexOf('center') != -1) {\r\n            next('/login?redirect=' + to.path);\r\n        }\r\n        else {\r\n            next()\r\n        }\r\n        //用户未登录||目前的判断都是放行.将来这里会'回手掏'增加一些判断\r\n        //用户未登录:不能进入/trade、/pay、/paysuccess、/center、/center/myorder  /center/teamorder\r\n        // let toPath = to.path;\r\n        // if (toPath.indexOf('trade') != -1 || toPath.indexOf('pay') != -1 || toPath.indexOf('center') != -1) {\r\n        //     next('/login?redirect=' + toPath);\r\n        // } else {\r\n        //     next();\r\n        // }\r\n    }\r\n});\r\n\r\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}