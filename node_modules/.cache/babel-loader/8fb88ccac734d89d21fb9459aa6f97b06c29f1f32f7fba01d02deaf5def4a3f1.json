{"ast":null,"code":"import Vue from \"vue\";\nimport Vuerouter from \"vue-router\";\nVue.use(Vuerouter);\nimport store from '../store';\nimport addcartsuccess from \"@/pages/addcartsuccess/index.vue\";\nimport Home from \"@/pages/home/index.vue\";\nimport Trade from \"@/pages/trade/index.vue\";\nimport Login from \"@/pages/login/index.vue\";\nimport Register from \"@/pages/register/index.vue\";\nimport Search from \"@/pages/search/index.vue\";\nimport Detail from \"@/pages/detail/index.vue\";\nimport Shopcart from \"@/pages/shopcart/index.vue\";\nimport Pay from \"@/pages/pay/index.vue\";\nimport Success from \"@/pages/paysuccess/index.vue\";\nimport Center from \"@/pages/center/index.vue\";\nimport myorder from \"@/pages/center/myOrder/index.vue\";\nimport teamorder from \"@/pages/center/teamOrder/index.vue\";\nlet router = new Vuerouter({\n  routes: [{\n    path: '/',\n    redirect: '/home'\n  }, {\n    path: '/home',\n    component: Home,\n    name: 'home',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/login',\n    component: Login,\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/trade',\n    component: Trade,\n    beforeEnter(to, from, next) {\n      if (localStorage.getItem('TOKEN')) {\n        next();\n      } else {\n        alert('请先登录');\n      }\n    },\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/register',\n    component: Register,\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/search/:keyword?',\n    component: Search,\n    name: 'search',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/detail/:spid',\n    component: Detail,\n    name: 'detail',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/addcartsuccess',\n    component: addcartsuccess,\n    name: 'addcartsuccess',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/shopcart',\n    component: Shopcart,\n    name: 'shopcart',\n    meta: {\n      show: true\n    }\n  }, {\n    path: '/pay',\n    component: Pay,\n    name: 'pay',\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/success',\n    component: Success,\n    name: 'success',\n    meta: {\n      show: false\n    }\n  }, {\n    path: '/center',\n    component: Center,\n    name: 'center',\n    meta: {\n      show: true\n    },\n    children: [{\n      path: \"myorder\",\n      component: myorder\n    }, {\n      path: \"teamorder\",\n      component: teamorder\n    }, {\n      path: \"/center\",\n      redirect: \"/center/myorder\"\n    }]\n  }],\n  scrollBehavior() {\n    return {\n      x: 0,\n      y: 0\n    };\n  }\n});\nrouter.beforeEach(async (to, from, next) => {\n  //to:去的那个路由的信息\n  //from:从那个路由而来的信息\n  //next:放行函数!!!!!! \n  //第一种：next(),放行函数，放行到它想去的路由！！！\n  //第二种:next(path),守卫指定放行到那个路由去?\n\n  //用户是否登录:取决于仓库里面是否有token！！！\n  //每一次路由跳转之前需要用有用户信息在跳转,没有发请求获取用户信息在跳转！！！！\n  //token\n  let hasToken = store.state.user.token;\n  //用户信息\n  let hasNickName = store.state.user.userdata.nickName;\n  //用户登录\n  if (hasToken) {\n    //用户登录了,不能去login\n    if (to.path == \"/login\") {\n      next(from.fullPath);\n    } else {\n      //用户登陆了,而且还有用户信息【去的并非是login】\n      if (hasNickName) {\n        next();\n      } else {\n        //用户登陆了,但是没有用户信息\n        // try {\n        //     //发请求获取用户信息以后在放行\n        //     await store.dispatch('getUserInfo');\n        //     next();\n        // } catch (error) {\n        //     //用户没有信息，还携带token发请求获取用户信息【失败】\n        //     //token【学生证失效了】\n        //     //token失效:本地清空数据、服务器的token通知服务器清除\n        //     await store.dispatch('logout');\n\n        //     //回到登录页，重新获取一个新的学生证\n        //     next('/login');\n        // }\n        await store.dispatch('logout');\n      }\n    }\n  } else {\n    if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/center') != -1) {\n      next('/login?redirect=');\n    }\n    next();\n    //用户未登录||目前的判断都是放行.将来这里会'回手掏'增加一些判断\n    //用户未登录:不能进入/trade、/pay、/paysuccess、/center、/center/myorder  /center/teamorder\n    // let toPath = to.path;\n    // if (toPath.indexOf('trade') != -1 || toPath.indexOf('pay') != -1 || toPath.indexOf('center') != -1) {\n    //     next('/login?redirect=' + toPath);\n    // } else {\n    //     next();\n    // }\n  }\n});\n\nexport default router;","map":{"version":3,"names":["Vue","Vuerouter","use","store","addcartsuccess","Home","Trade","Login","Register","Search","Detail","Shopcart","Pay","Success","Center","myorder","teamorder","router","routes","path","redirect","component","name","meta","show","beforeEnter","to","from","next","localStorage","getItem","alert","children","scrollBehavior","x","y","beforeEach","hasToken","state","user","token","hasNickName","userdata","nickName","fullPath","dispatch","indexOf"],"sources":["E:/360MoveData/Users/Admin/Desktop/qian/cil/shangpinhui/src/router/router.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport Vuerouter from \"vue-router\"\r\nVue.use(Vuerouter)\r\n\r\nimport store from '../store'\r\nimport addcartsuccess from \"@/pages/addcartsuccess/index.vue\"\r\nimport Home from \"@/pages/home/index.vue\"\r\nimport Trade from \"@/pages/trade/index.vue\"\r\nimport Login from \"@/pages/login/index.vue\"\r\nimport Register from \"@/pages/register/index.vue\"\r\nimport Search from \"@/pages/search/index.vue\"\r\nimport Detail from \"@/pages/detail/index.vue\"\r\nimport Shopcart from \"@/pages/shopcart/index.vue\"\r\nimport Pay from \"@/pages/pay/index.vue\"\r\nimport Success from \"@/pages/paysuccess/index.vue\"\r\nimport Center from \"@/pages/center/index.vue\"\r\nimport myorder from \"@/pages/center/myOrder/index.vue\"\r\nimport teamorder from \"@/pages/center/teamOrder/index.vue\"\r\n\r\nlet router = new Vuerouter({\r\n    routes: [\r\n        {\r\n            path: '/',\r\n            redirect: '/home'\r\n        },\r\n        {\r\n            path: '/home',\r\n            component: Home,\r\n            name: 'home',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/login',\r\n            component: Login,\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/trade',\r\n            component: Trade,\r\n            beforeEnter(to, from, next) {\r\n                if (localStorage.getItem('TOKEN')) {\r\n                    next()\r\n                }\r\n                else {\r\n                    alert('请先登录')\r\n                }\r\n            },\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/register',\r\n            component: Register,\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/search/:keyword?',\r\n            component: Search,\r\n\r\n            name: 'search',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/detail/:spid',\r\n            component: Detail,\r\n\r\n            name: 'detail',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/addcartsuccess',\r\n            component: addcartsuccess,\r\n\r\n            name: 'addcartsuccess',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/shopcart',\r\n            component: Shopcart,\r\n\r\n            name: 'shopcart',\r\n            meta: {\r\n                show: true\r\n            }\r\n        },\r\n        {\r\n            path: '/pay',\r\n            component: Pay,\r\n\r\n            name: 'pay',\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/success',\r\n            component: Success,\r\n\r\n            name: 'success',\r\n            meta: {\r\n                show: false\r\n            }\r\n        },\r\n        {\r\n            path: '/center',\r\n            component: Center,\r\n\r\n            name: 'center',\r\n            meta: {\r\n                show: true\r\n            },\r\n            children: [\r\n                {\r\n                    path: \"myorder\",\r\n                    component: myorder\r\n                },\r\n                {\r\n                    path: \"teamorder\",\r\n                    component: teamorder\r\n                },\r\n                {\r\n                    path: \"/center\",\r\n                    redirect: \"/center/myorder\"\r\n                },\r\n            ]\r\n        },\r\n    ],\r\n    scrollBehavior() {\r\n        return { x: 0, y: 0 }\r\n    }\r\n\r\n})\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n    //to:去的那个路由的信息\r\n    //from:从那个路由而来的信息\r\n    //next:放行函数!!!!!! \r\n    //第一种：next(),放行函数，放行到它想去的路由！！！\r\n    //第二种:next(path),守卫指定放行到那个路由去?\r\n\r\n    //用户是否登录:取决于仓库里面是否有token！！！\r\n    //每一次路由跳转之前需要用有用户信息在跳转,没有发请求获取用户信息在跳转！！！！\r\n    //token\r\n    let hasToken = store.state.user.token;\r\n    //用户信息\r\n    let hasNickName = store.state.user.userdata.nickName;\r\n    //用户登录\r\n    if (hasToken) {\r\n        //用户登录了,不能去login\r\n        if (to.path == \"/login\") {\r\n\r\n            next(from.fullPath);\r\n        } else {\r\n            //用户登陆了,而且还有用户信息【去的并非是login】\r\n            if (hasNickName) {\r\n                next();\r\n            } else {\r\n                //用户登陆了,但是没有用户信息\r\n                // try {\r\n                //     //发请求获取用户信息以后在放行\r\n                //     await store.dispatch('getUserInfo');\r\n                //     next();\r\n                // } catch (error) {\r\n                //     //用户没有信息，还携带token发请求获取用户信息【失败】\r\n                //     //token【学生证失效了】\r\n                //     //token失效:本地清空数据、服务器的token通知服务器清除\r\n                //     await store.dispatch('logout');\r\n\r\n                //     //回到登录页，重新获取一个新的学生证\r\n                //     next('/login');\r\n                // }\r\n                await store.dispatch('logout');\r\n            }\r\n        }\r\n    } else {\r\n        if (to.path.indexOf('/trade') != -1 || to.path.indexOf('/pay') != -1 || to.path.indexOf('/center') != -1) {\r\n            next('/login?redirect=');\r\n        }\r\n            next()\r\n        //用户未登录||目前的判断都是放行.将来这里会'回手掏'增加一些判断\r\n        //用户未登录:不能进入/trade、/pay、/paysuccess、/center、/center/myorder  /center/teamorder\r\n        // let toPath = to.path;\r\n        // if (toPath.indexOf('trade') != -1 || toPath.indexOf('pay') != -1 || toPath.indexOf('center') != -1) {\r\n        //     next('/login?redirect=' + toPath);\r\n        // } else {\r\n        //     next();\r\n        // }\r\n    }\r\n});\r\n\r\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}