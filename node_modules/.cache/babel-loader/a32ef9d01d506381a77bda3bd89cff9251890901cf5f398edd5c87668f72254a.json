{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"Trade\",\n  data() {\n    return {\n      msg: \"\",\n      pay: [\"在线支付\", \"货到付款\"],\n      current: 0\n    };\n  },\n  mounted() {\n    this.getAddress();\n    this.getShopInfo();\n  },\n  methods: {\n    changecurrent(index) {\n      this.current = index;\n    },\n    //获取用户地址信息\n    getAddress() {\n      this.$store.dispatch(\"getAddress\");\n    },\n    //获取商品清单的数据\n    getShopInfo() {\n      this.$store.dispatch(\"getShopInfo\");\n    },\n    //修改默认地址\n    changeDefault(user) {\n      //排他操作\n      //全部用户信息isDefault = 0；\n      this.address.forEach(item => {\n        item.isDefault = \"0\";\n      });\n      user.isDefault = \"1\";\n    },\n    //提交订单\n    async submitInfo() {\n      //整理参数:交易编码\n      let tradeNo = this.tradeInfo.tradeNo;\n      let data = {\n        consignee: this.defaultUser.consignee,\n        //付款人的名字\n        consigneeTel: this.defaultUser.phoneNum,\n        //付款人的手机号\n        deliveryAddress: this.defaultUser.fullAddress,\n        //付款人收货地址\n        paymentWay: \"ONLINE\",\n        //支付方式都是在线支付\n        orderComment: this.msg,\n        //买家留言\n        orderDetailList: this.tradeInfo.detailArrayList //购物车商品信息\n      };\n\n      //发请求:提交订单\n      try {\n        await this.$store.dispatch(\"submitInfo\", {\n          tradeNo,\n          data\n        });\n        //将来提交订单成功【订单ID生成】，路由跳转pay页面，进行支付\n        this.$router.push({\n          path: \"/pay\",\n          query: {\n            orderId: this.orderId\n          }\n        });\n      } catch (error) {\n        alert(error.message);\n      }\n    }\n  },\n  computed: {\n    ...mapState({\n      address: state => state.trade.address,\n      tradeInfo: state => state.trade.tradeInfo,\n      orderId: state => state.trade.payId\n    }),\n    //默认收件人的信息计算出来\n    defaultUser() {\n      //find:数组的方法,找到复合条件的元素.回调需要返回布尔值【真|假】，真即为查找结果【如果多个结果都为真，取其中一个】\n      return this.address.find(item => item.isDefault == \"1\") || {};\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}